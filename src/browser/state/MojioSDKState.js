// Generated by CoffeeScript 1.12.7
(function() {
  var HttpWrapper, MojioSDKState, MojioValidator,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  HttpWrapper = require('../wrappers/HttpWrapper');

  MojioValidator = require('./MojioValidator');

  module.exports = MojioSDKState = (function() {
    var accountsURL, apiURL, defaultEndpoint, pushURL;

    accountsURL = "accounts.moj.io";

    pushURL = "push.moj.io";

    apiURL = "api2.moj.io";

    defaultEndpoint = "api";

    function MojioSDKState(options) {
      var p, v;
      if (options == null) {
        options = {
          environment: '',
          version: 'v2'
        };
      }
      this.setCallback = bind(this.setCallback, this);
      this.redirect = bind(this.redirect, this);
      this.initiate = bind(this.initiate, this);
      this._state = {};
      this.options = {};
      for (p in options) {
        v = options[p];
        this.options[p] = v;
      }
      if (this.options.environment == null) {
        this.options.environment = '';
      }
      if (this.options.version == null) {
        this.options.version = 'v2';
      }
      if (this.options.environment !== '') {
        this.options.environment += '-';
      }
      if (!this.options.accountsURL) {
        this.options.accountsURL = accountsURL;
      }
      if (!this.options.apiURL) {
        this.options.apiURL = apiURL;
      }
      if (!this.options.pushURL) {
        this.options.pushURL = pushURL;
      }
      this.endpoints = {
        accounts: {
          uri: "https://" + this.options.environment + this.options.accountsURL,
          encoding: true
        },
        api: {
          uri: "https://" + this.options.environment + this.options.apiURL + '/' + this.options.version,
          encoding: false
        },
        push: {
          uri: "https://" + this.options.environment + this.options.pushURL + '/' + this.options.version,
          encoding: false
        }
      };
      this.validator = new MojioValidator();
      this.reset();
    }

    MojioSDKState.prototype.initiate = function(callback) {
      var callbacks, httpWrapper;
      if (this._state.mock) {
        return callback(null, {
          id: "1"
        });
      } else {
        callbacks = (function(_this) {
          return function(error, result) {
            if ((_this._state.callback != null)) {
              _this._state.callback(error, result);
            }
            if (callback) {
              return callback(error, result);
            }
          };
        })(this);
        if (this._state.answer != null) {
          callbacks(null, this._state.answer);
        } else {
          httpWrapper = new HttpWrapper(this._state.token, this.endpoints[this._state.endpoint].uri, this.endpoints[this._state.endpoint].encoding);
          httpWrapper.request(this.parts(false), callbacks);
        }
        return this.reset();
      }
    };

    MojioSDKState.prototype.redirect = function(redirectClass) {
      var httpWrapper;
      if (redirectClass == null) {
        redirectClass = null;
      }
      httpWrapper = new HttpWrapper(this._state.token, this.endpoints[this._state.endpoint].uri, this.endpoints[this._state.endpoint].encoding);
      return httpWrapper.redirect(this.parts(true), redirectClass);
    };

    MojioSDKState.prototype.url = function(bodyAsParameters) {
      var httpWrapper, url;
      if (bodyAsParameters == null) {
        bodyAsParameters = true;
      }
      httpWrapper = new HttpWrapper(this._state.token, this.endpoints[this._state.endpoint].uri, this.endpoints[this._state.endpoint].encoding);
      url = httpWrapper.url(this.parts(bodyAsParameters));
      return url;
    };

    MojioSDKState.prototype.parts = function(bodyAsParameters) {
      if (bodyAsParameters == null) {
        bodyAsParameters = true;
      }
      return {
        method: this._state.method,
        resource: this._state.resource,
        pid: this._state.pid,
        action: this._state.action,
        sid: this._state.sid,
        object: this._state.object,
        tid: this._state.tid,
        body: bodyAsParameters ? "" : this._state.body,
        params: bodyAsParameters ? this._state.body : this._state.params
      };
    };

    MojioSDKState.prototype.show = function() {
      return this._state;
    };

    MojioSDKState.prototype.setCallback = function(callback) {
      this._state.callback = callback;
    };

    MojioSDKState.prototype.setToken = function(token) {
      this._state.token = token;
    };

    MojioSDKState.prototype.getToken = function() {
      return this._state.token;
    };

    MojioSDKState.prototype.setAnswer = function(token) {
      return this._state.answer = token;
    };

    MojioSDKState.prototype.setBody_ObjectOrJson = function(object_or_json_string) {
      switch (typeof object_or_json_string) {
        case "string":
          this._state.body = object_or_json_string;
          break;
        case "object":
          this._state.body = object_or_json_string;
      }
      return this._state;
    };

    MojioSDKState.prototype.setEndpoint = function(endpoint) {
      var validateEndpoint;
      validateEndpoint = (function(_this) {
        return function(endpoint, endpoints) {
          var found, name, value;
          found = false;
          for (name in endpoints) {
            value = endpoints[name];
            if (endpoint === name) {
              found = true;
              break;
            }
          }
          if (!found) {
            throw "Endpoint must be accounts, api, or push";
          }
          return found;
        };
      })(this);
      if (validateEndpoint(endpoint, this.endpoints)) {
        return this._state.endpoint = endpoint;
      }
    };

    MojioSDKState.prototype.setMethod = function(method) {
      this.reset();
      return this._state.method = method;
    };

    MojioSDKState.prototype.setResource = function(resource) {
      if (this._state.resource === 'Groups') {
        return this.setObject(resource);
      } else {
        return this._state.resource = resource;
      }
    };

    MojioSDKState.prototype.setObject = function(object) {
      return this._state.object = object;
    };

    MojioSDKState.prototype.setAction = function(action) {
      return this._state.action = action;
    };

    MojioSDKState.prototype.setParams = function(parameters) {
      var property, results, value;
      results = [];
      for (property in parameters) {
        value = parameters[property];
        results.push(this._state.parameters[property] = value);
      }
      return results;
    };

    MojioSDKState.prototype.setBody = function(parameters) {
      var property, value;
      for (property in parameters) {
        value = parameters[property];
        this._state.body[property] = value;
      }
    };

    MojioSDKState.prototype.setId = function(id) {
      return this.setPrimaryId(id);
    };

    MojioSDKState.prototype.setPrimaryId = function(id) {
      return this._state.pid = id;
    };

    MojioSDKState.prototype.setSecondaryId = function(id) {
      return this._state.sid = id;
    };

    MojioSDKState.prototype.setTertiaryId = function(id) {
      return this._state.tid = id;
    };

    MojioSDKState.prototype.getBody = function() {
      return this._state.body;
    };

    MojioSDKState.prototype.getParams = function() {
      return this._state.parameters;
    };

    MojioSDKState.prototype.setWhere = function(id_example_or_query) {
      this._state.type = "all";
      this._state.where = null;
      if (id_example_or_query !== null) {
        switch (typeof id_example_or_query) {
          case "number":
            this._state.type = "id";
            this._state.where = id_example_or_query;
            break;
          case "string":
            this._state.type = "query";
            this._state.where = id_example_or_query;
            break;
          case "object":
            this._state.type = "example";
            this._state.where = id_example_or_query;
            break;
          default:
            this._state.type = "query";
            this._state.where = id_example_or_query;
        }
      }
      return this._state;
    };

    MojioSDKState.prototype.fixup = function() {
      var lowP, lowV, p, ref, results, v;
      ref = this._state;
      results = [];
      for (p in ref) {
        v = ref[p];
        lowP = p.toLowerCase();
        lowV = v.toLowerCase();
        this._state[lowP] = lowV;
        results.push(delete this._state[p]);
      }
      return results;
    };

    MojioSDKState.prototype.mock = function() {
      return this._state.mock = true;
    };

    MojioSDKState.prototype.reset = function() {
      this._state.mock = false;
      this._state.callback = null;
      this._state.answer = null;
      this._state.endpoint = defaultEndpoint;
      this._state.method = "GET";
      this._state.resource = "Vehicles";
      this._state.pid = null;
      this._state.sid = null;
      this._state.tid = null;
      this._state.action = null;
      this._state.object = null;
      this._state.parameters = {};
      this._state.operation = "";
      this._state.limit = 10;
      this._state.offset = 0;
      this._state.desc = false;
      this._state.query = null;
      this._state.field = null;
      this._state.fields = null;
      this._state.type = "all";
      this._state.where = null;
      return this._state.body = {};
    };

    return MojioSDKState;

  })();

}).call(this);

//# sourceMappingURL=MojioSDKState.js.map
